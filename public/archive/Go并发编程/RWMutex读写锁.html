

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Youpeng Cui">
  <meta name="keywords" content="Linux Go Mac">
  
    <meta name="description" content="mofan.life: Youpeng&amp;#39;s Technology Blog">
  
  
  
  <title>page.title - mofan.life: Youpeng&#39;s Technology Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />





<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"www.mofan.life","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":3},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":"e16cbb6ce764a8813654d6c255365079","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 60vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Mofan</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archive
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Category
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tag
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/abouts/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.1)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="page.title"></span>
          
        </div>

        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      <div class="container nopadding-x-md">
        <div id="board"
          >
          
          <div class="container">
            <div class="row">
              <div class="col-12 col-md-10 m-auto">
                

<article class="page-content">
  <h1 id="RWMutex-读写锁"><a href="#RWMutex-读写锁" class="headerlink" title="RWMutex: 读写锁"></a>RWMutex: 读写锁</h1><p>读写锁出现的背景：</p>
<p>Go中的同步原语 Mutex 用来保证读写共享资源的安全性。不管是读还是写，我们都通过 Mutex 来保证只有一个 goroutine 访问共享资源，这在某些情况下有点“浪费”。比如说，<strong>在写少读多的情况下</strong>，即使一段时间内没有写操作，大量并发的读访问也不得不在 Mutex 的保护下变成了串行访问，这个时候，使用 Mutex，对性能的影响就比较大。RWMutex的出现，将 Mutex 中的串行读变成并行读，从而提高读操纵的性能。</p>
<p>RWMutex：</p>
<p>当写操作的 goroutine 持有锁的时候，它就是一个排外锁，其它的写操作和读操作的 goroutine，需要阻塞等待持有这个锁的 goroutine 释放锁。    </p>
<p>RWMutex的方法有5个：</p>
<ul>
<li>Lock/Unlock：写操作时调用的方法。如果锁已经被 reader 或者 writer 持有，那么，Lock 方法会一直阻塞，直到能获取到锁；Unlock 则是配对的释放锁的方法。</li>
<li>RLock/RUnlock：读操作时调用的方法。如果锁已经被 writer 持有的话，RLock 方法会一直阻塞，直到能获取到锁，否则就直接返回；而 RUnlock 是 reader 释放锁的方法。</li>
<li>RLocker：这个方法的作用是为读操作返回一个 Locker 接口的对象。它的 Lock 方法会调用 RWMutex 的 RLock 方法，它的 Unlock 方法会调用 RWMutex 的 RUnlock 方法。</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs txt"><br>2022-02-16 18:34:12     [DEBG]: [PullCommand] (session id) i am [1645007652531628652], got session [1645007652531628652],they are same,do nothing!,stream pointer address:0xc0006176a0<br>2022-02-16 18:34:12     [DEBG]: [PullCommand] i am [1645007652531628652] after send CloseOldConnection<br>robot-201902052:7d2b0fe5-f675-5ace-b1ed-00420e31df3a<br><br>(/root/grpc/restful_api/robot_platform/src/restful_api/service/robot.go:115) <br>[2022-02-16 18:34:23]  [1.14ms]  SELECT count(robotsn) as total FROM &quot;robot&quot;    <br>[0 rows affected or returned ] <br><br>(/root/grpc/restful_api/robot_platform/src/restful_api/service/robot.go:150) <br>[2022-02-16 18:34:23]  [1.52ms]  SELECT * FROM &quot;robot&quot;   ORDER BY case when robotsn in (&#x27;robot-20220110001:89c3a2d2-e0b4-537c-b6c4-ddab86068a82&#x27;,&#x27;robot-20200326001:d3276a3f-588e-5c11-8b20-0aba3b7f2c6f&#x27;,&#x27;robot-20211021001:51606b7a-cb9c-57e5-aab6-93611c134d7d&#x27;,&#x27;robot-20210820001:db0540e2-a929-5faf-a625-c7a19905d9f3&#x27;,&#x27;robot-201902052:7d2b0fe5-f675-5ace-b1ed-00420e31df3a&#x27;,&#x27;robot-20200911002:dae17043-ef26-53b7-a4f1-e0ec5d6b5ff0&#x27;,&#x27;robot-20211207001:b643c77d-5fd5-52f5-bdab-a6256d413e29&#x27;,&#x27;robot-20200313002:37112663-b0f6-55ee-a6a3-0046de8b6a61&#x27;,&#x27;robot-2021121001:8b93f629-7352-52e6-ba77-944e7a16e8fc&#x27;) then 0 when nickname!=&#x27;&#x27; then 1 else 2 end LIMIT 18 OFFSET 0  <br>[18 rows affected or returned ] <br></code></pre></td></tr></table></figure>




<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs txt"><br>&#x27;robot-20220110001:89c3a2d2-e0b4-537c-b6c4-ddab86068a82&#x27;,<br>&#x27;robot-20200326001:d3276a3f-588e-5c11-8b20-0aba3b7f2c6f&#x27;,<br>&#x27;robot-20211021001:51606b7a-cb9c-57e5-aab6-93611c134d7d&#x27;,<br>&#x27;robot-20210820001:db0540e2-a929-5faf-a625-c7a19905d9f3&#x27;,<br><br><br>&#x27;robot-20200911002:dae17043-ef26-53b7-a4f1-e0ec5d6b5ff0&#x27;,<br><br> <br> &#x27;robot-201902052:7d2b0fe5-f675-5ace-b1ed-00420e31df3a&#x27;,<br><br><br><br>1)  &quot;robot-20210820001:db0540e2-a929-5faf-a625-c7a19905d9f3&quot;<br>2)  &quot;robot-20191212004:fb4dc94c-3287-5208-8d50-bcec2327b828&quot;<br>3)  &quot;robot-20211130001:61b887f7-45e1-505b-a046-a988509a6ce4&quot;<br>4)  &quot;robot-20220114001:624e8f95-1f6a-574d-8a5b-03c4ff4f7892&quot;<br>5)  &quot;robot-20211210002:9c45e304-fb9d-58f5-942e-7146947fae6a&quot;<br>6)  &quot;robot-20211021002:72ac19a3-b414-59df-89e2-65dc6b2527bb&quot;<br>7)  &quot;robot-20200911002:dae17043-ef26-53b7-a4f1-e0ec5d6b5ff0&quot;<br>8)  &quot;robot-20220122001:1f55c3ca-914d-5d16-9830-1f0da1c1db98&quot;<br>9)  &quot;robot-20220114002:bd1080aa-ecb4-5b25-acfd-84c2270d9246&quot;<br>10) &quot;robot-20211021001:51606b7a-cb9c-57e5-aab6-93611c134d7d&quot;<br>11) &quot;robot-20220110001:89c3a2d2-e0b4-537c-b6c4-ddab86068a82&quot;<br>12) &quot;robot-20200310001:6b081aa4-eaf7-5343-86ff-fba65ec1cbbf&quot;<br>13) &quot;robot-20210201001:fe03c5ea-c945-5b12-9129-6f547a07a5aa&quot;<br>14) &quot;robot-20211208001:3ef059ef-5efe-53cd-9754-e280ec230dcd&quot;<br>16) &quot;robot-20211008001:ef131bbc-87d1-5e3e-9ba6-5d76ceca9b60&quot;<br>17) &quot;robot-20211021005:e56af5d0-ba42-5ecc-8792-b1fdee6bbaec&quot;<br>18) &quot;robot-20210601002:4324b329-38d3-5d1d-aee8-918cdacf5eed&quot;<br>19) &quot;robot-20200326001:d3276a3f-588e-5c11-8b20-0aba3b7f2c6f&quot;<br>20) &quot;robot-2019050001:8b3be2ce-19cf-52aa-a72b-688d5eaa6c57&quot;<br><br><br><br>15) &quot;robot-20211207001:b643c77d-5fd5-52f5-bdab-a6256d413e29&quot;<br>    &#x27;robot-20211207001:b643c77d-5fd5-52f5-bdab-a6256d413e29&#x27;,<br><br><br>21) &quot;robot-2021121001:8b93f629-7352-52e6-ba77-944e7a16e8fc&quot;<br>    &#x27;robot-2021121001:8b93f629-7352-52e6-ba77-944e7a16e8fc&#x27;<br></code></pre></td></tr></table></figure>


  

</article>



              </div>
            </div>
          </div>
        </div>
      </div>
    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate"></span> <!--  <span id="times"></span> --> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      京ICP备2022000091号
    </a>
  </span>
  
</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>






  
    <script  src="/js/img-lazyload.js" ></script>
  




  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
