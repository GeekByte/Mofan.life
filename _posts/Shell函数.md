---
title: Shell脚本之函数
categories:
  - Linux
  - Shell
tags:
  - Linux
  - Shell
date: 2021-07-31 13:14:30
---

Shell中函数的定义如下：

```shell
[ function ] funname [()]

{

    action;

    [return int;]

}
```

说明：

- 1、可以带function fun() 定义，也可以直接fun() 定义,不带任何参数。
- 2、参数返回，可以显示加：return 返回，如果不加，将以最后一条命令**运行结果**，作为返回值。要特别注意这里的**运行结果**，不是执行后返回的结果，函数的返回值只能是 0～255 之间的值，因此，函数与命令的执行结果可以作为条件语句使用，要注意的是，和 C 语言不同，shell 语言中 0 代表 true，0 以外的值代表 false。

### 带有 return 的函数

```shell
funWithReturn(){
    echo "这个函数会对输入的两个数字进行相加运算..."
    echo "输入第一个数字: "
    read aNum
    echo "输入第二个数字: "
    read anotherNum
    echo "两个数字分别为 $aNum 和 $anotherNum !"
    return $(($aNum+$anotherNum))
}
funWithReturn
echo "输入的两个数字之和为 $? !"
```

执行结果：

```shell
这个函数会对输入的两个数字进行相加运算...
输入第一个数字: 
1
输入第二个数字: 
2
两个数字分别为 1 和 2 !
输入的两个数字之和为 3 !
```

函数返回值在调用该函数后通过 `$?` 来获得。`$?` 仅对其上一条指令负责，一旦函数返回后其返回值没有立即保存入参数，那么其返回值将不再能通过 `$?` 获得。

> 你可能对这两个数字的和有疑问，因为返回值显示的数字范围只能是 0~255，那是否意味着它只能计算结果为 255 以内的值呢，答案不是，对于结果超出 255 的值，它返回的值为: 结果 - 256 。

注意：所有函数在使用前必须定义。这意味着必须将函数放在脚本开始部分，直至shell解释器首次发现它时，才可以使用。调用函数仅使用其函数名即可。

### 函数参数

在Shell中，调用函数时可以向其传递参数。在函数体内部，通过 $n 的形式来获取参数的值，例如，$1表示第一个参数，$2表示第二个参数...，注意，当调用第10个及以上参数的时候，要加`{}`

```shell
funWithParam(){
    echo "第一个参数为 $1 !"
    echo "第二个参数为 $2 !"
    echo "第十个参数为 $10 !"
    echo "第十个参数为 ${10} !"
    echo "第十一个参数为 ${11} !"
    echo "参数总数有 $# 个!"
    echo "作为一个字符串输出所有参数 $* !"
}
funWithParam 1 2 3 4 5 6 7 8 9 34 73
```

执行结果:

```tex
第一个参数为 1 !
第二个参数为 2 !
第十个参数为 10 !
第十个参数为 34 !
第十一个参数为 73 !
参数总数有 11 个!
作为一个字符串输出所有参数 1 2 3 4 5 6 7 8 9 34 73 !
```

另外，还有几个特殊字符用来处理参数：

| 参数处理 | 说明                                                         |
| :------- | :----------------------------------------------------------- |
| $#       | 传递到脚本或函数的参数个数                                   |
| $*       | 以一个单字符串显示所有向脚本传递的参数                       |
| $$       | 脚本运行的当前进程ID号                                       |
| $!       | 后台运行的最后一个进程的ID号                                 |
| $@       | 与$*相同，但是使用时加引号，并在引号中返回每个参数。         |
| $-       | 显示Shell使用的当前选项，与set命令功能相同。                 |
| $?       | 显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误。 |

```shell
function func() {
    echo "传入的参数个数为: $# "
    echo "用一个字符串显示传入的参数: $* "
    echo "脚本当前运行的进程ID为：$$ "
    echo "后台运行的最后一个进程ID为: $! "
    echo "传入的每个参数为: ${@} "
    echo "Shell当前使用的选项为: $- "
}

func 1 2 3 "hello" "world"
echo "最后命令的退出状态为: $? "
```

执行结果：

```tex
传入的参数个数为: 5
用一个字符串显示传入的参数: 1 2 3 hello world
脚本当前运行的进程ID为：3377
后台运行的最后一个进程ID为:
传入的每个参数为: 1 2 3 hello world
Shell当前使用的选项为: hB
最后命令的退出状态为: 0
```

